<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Laundromart | Blank Page</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/plugins/fontawesome-free/css/all.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="assets/css/adminlte.min.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
</head>

<body class="hold-transition sidebar-mini">
    <!-- Site wrapper -->
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>

            <!-- SEARCH FORM -->
            <form class="form-inline ml-3">
                <div class="input-group input-group-sm">
                    <input class="form-control form-control-navbar" type="search" placeholder="Search"
                        aria-label="Search">
                    <div class="input-group-append">
                        <button class="btn btn-navbar" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="index.html" class="brand-link">
                <img src="assets/img/logo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                    style="opacity: .8">
                <span class="brand-text font-weight-light">Laundromart</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <i class="nav-icon fas fa-microchip"></i>
                                <p>
                                    Installation
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="appearance.html" class="nav-link">
                                <i class="nav-icon fas fa-cog"></i>
                                <p>
                                    Website Appearance
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="email-setup.html" class="nav-link">
                                <i class="nav-icon fas fa-envelope"></i>
                                <p>
                                    Email Setup
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="payment-gateways.html" class="nav-link active">
                                <i class="nav-icon fas fa-credit-card"></i>
                                <p>
                                    Setup Payment Gateway
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="create-staff.html" class="nav-link">
                                <i class="nav-icon fas fa-users"></i>
                                <p>
                                    Create Staff
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="locations.html" class="nav-link">
                                <i class="nav-icon fas fa-map"></i>
                                <p>
                                    Setup Locations
                                </p>
                            </a>
                        </li>


                        <li class="nav-header">MISCELLANEOUS</li>
                        <li class="nav-item">
                            <a href="https://demo.gbams.dev/laundromart/_documentation" class="nav-link">
                                <i class="nav-icon fas fa-file"></i>
                                <p>Online Documentation</p>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper px-4 py-2">
            <!-- Main content -->
            <div class="content-header">
                <h1 class="text-dark">Basic Setup</h1>
            </div>
            <div class="content px-2">
                <p>The Basic setup for Payment Gateway can be performed in <em>Settings => Payment Settings</em> on admin dashboard.</p>
            </div>
            <div class="content-header">
                <h1 class="text-dark">Integrate Custom Payment Gateway</h1>
            </div>
            <div class="content px-2">
                <p>Attached is a basic guide to integrate a custom payment gateway:</p>

                <ul>
                    <li>Add the gateway to the database <em>(payment_gateways table)</em>. <span class="text-danger text-uppercase">The first letter of the name must be capitalised</span>.</li>
                    <li>Head over to <em>App\Controllers\PaymentGateways</em> folder and create a new file for the payment gateway. The case must match the case used in your database above.</li>
                    <li>open StarterTemplate.php file and copy the content to your gateway file. The file should contain 5 functions, which are:
                        <ul>
                            <li><strong>initiatePayment($invoice_reference, $total_price, $tax, $total_due, $data, $user)</strong> - This function will be triggered when user clicks pay button.
                                <br> You perform payment initiation here, and redirect to the payment gateway.
                                <ul>
                                    <li>$invoice_reference is a unique refrence key.</li>
                                    <li>$total_price is the total price of the order.</li>
                                    <li>$tax is the total Tax of the order.</li>
                                    <li>$total_due is the total amount user is expected to pay.</li>
                                    <li>$data is an array which contains all details of order.</li>
                                    <li>$user is an array containing user details</li>
                                </ul>
                            </li>

                            <li>
                                <strong>failedPayment($invoice_reference)</strong> - this function will be triggered for failed payment.
                            </li>

                            <li>
                                <strong>cancelledPayment($invoice_reference)</strong> - this function will be triggered when user cancels payment.
                            </li>
                            
                            <li>
                                <strong>successfulPayment()</strong> - this function will be triggered when payment is successful.
                                <br>Depending on the Gateway, you can verify payment and complete order here (SEE FlutterwaveController & PaystackController for example).
                            </li>
                            
                            <li>
                                <strong>processWebHook()</strong> - this function will be triggered when a webhook response is received.
                                - you perform all webhook action here.
                            </li>
                            
                            <li>
                                <strong>NOTE:</strong> 
                                <ul>
                                    <li>
                                        After verifying successful payment in successfulPayment() or processWebHook() function, You need to inform the system to update the invoice and process order. You do that using this line of code:<br>
                                        <em class="text-danger">
                                        $this->InvoiceController->markInvoiceAsPaid(
                                            $invoice_reference,
                                            $amountPaid,
                                            Gateway Name,
                                            $transaction_ref
                                        );
                                        </em>

                                            <ul>
                                                <li>$invoice_reference = The invoice_refrence passed to initiate payment function. For proper security, ensure you retrieve it from the JSON/XML data returned by the Payment Gateway, Not from the GET request. You can do this by passing it to the "Metadata" or "Custom data" object when initiating payment.</li>
                                                <li>$amountPaid = Amount paid by user</li>
                                                <li>Gateway Name = Name of the payment Gateway</li>
                                                <li>$transaction_ref = The transaction refrence from the payment gateway</li>
                                            </ul>
                                    </li>
                                    <li>
                                        While it is compulsory to create all the above functions, you don't have to put anything in the ones you don't need.
                                    </li>
                                    <li>
                                        For <em class="text-danger">failedPayment($invoice_reference) and cancelledPayment($invoice_reference)</em>, the system automatically updates the invoice and redirect user.
                                        You only need to put code inside this function if you want to perform any custom action.
                                    </li>
                                </ul>

                            </li>
                        </ul>

                    </li>
                    <li><strong>To generate the redirect URLs, you use the following:</strong>
                        <ul>
                            <li>
                                Cancel URL - fullUrl(route_to('payment_cancel_url', 'stripe', $invoice_reference))
                            </li>
                            <li>
                                Fail URL - fullUrl(route_to('payment_fail_url', 'stripe', $invoice_reference))
                            </li>
                            <li>
                                Success URL - fullUrl(route_to('payment_success_url', 'stripe'))
                            </li>
                            <li>
                                Webhook URL - fullUrl(route_to('payment_webhook_url', 'stripe'))
                            </li>
                        </ul>
                        <em class='text-danger'>Replace stripe with the name of the payment gateway you are integrating. The name must match what you have in your
                        database.</em>
                    </li>
                    <li>If you get stuck or confused, you can check the other gateway files for help.</li>
                    <li>To make it possible to set gateway API data from Admin dashboard,
                        add your new gateway settings to the payment settings page in
                        app\Views\backend\{{theme}}\admin\settings\payment_settings.php.
                    </li>
                    <li>Test your new integration.</li>
                </ul>

                <h4>Congratulations, You have just successfully setup a new payment gateway.</h4>
            </div>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
        
        </footer>
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="assets/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="assets/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="../../dist/js/demo.js"></script>
</body>
</html>